<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - Toki Japanese Highball</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="./examples/example.css">
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&family=Cormorant+Garamond:wght@400;500&display=swap');

			html, body {
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
			}

			body {
				font-family: 'Noto Sans JP', sans-serif;
				background: #0a0a0a url('./images/mr-background.jpg') center center / cover no-repeat;
			}

      #info {
        display: none; /* Hidden per user request */
      }

			#info .title-wrapper span {
				color: #7ec8e8;
				font-family: 'Cormorant Garamond', serif;
				font-weight: 500;
				letter-spacing: 1px;
			}

			#info .title-wrapper a {
				color: #ffffff;
			}

			#info small {
				color: rgba(255, 255, 255, 0.7);
			}

		#drinkControls {
			display: none; /* Moved to GUI panel */
		}

			#drinkControls h3 {
				margin: 0 0 16px 0;
				font-size: 15px;
				font-weight: 500;
				color: #7ec8e8;
				letter-spacing: 1px;
				font-family: 'Cormorant Garamond', serif;
				text-transform: uppercase;
			}

			.control-row {
				display: flex;
				align-items: center;
				justify-content: space-between;
				margin-bottom: 14px;
			}

			.control-row:last-child {
				margin-bottom: 0;
			}

			.control-row label {
				color: rgba(255, 255, 255, 0.8);
				font-size: 12px;
				min-width: 70px;
			}

			.control-row .controls {
				display: flex;
				align-items: center;
				gap: 8px;
			}

			#drinkControls button {
				background: rgba(126, 200, 232, 0.15);
				border: 1px solid rgba(126, 200, 232, 0.4);
				color: #7ec8e8;
				padding: 6px 12px;
				border-radius: 8px;
				cursor: pointer;
				font-size: 12px;
				font-weight: 500;
				transition: all 0.2s ease;
				font-family: inherit;
			}

			#drinkControls button:hover {
				background: rgba(126, 200, 232, 0.25);
				border-color: rgba(126, 200, 232, 0.6);
			}

			#drinkControls button:active {
				transform: scale(0.96);
			}

			#drinkControls button.active {
				background: rgba(126, 200, 232, 0.35);
				border-color: #7ec8e8;
			}

			#fizzValue {
				min-width: 32px;
				text-align: center;
				font-weight: 500;
				color: #ffffff;
			}

			.slider-control {
				width: 70px;
				height: 4px;
				-webkit-appearance: none;
				appearance: none;
				background: rgba(126, 200, 232, 0.25);
				border-radius: 2px;
				outline: none;
				cursor: pointer;
			}

			.slider-control::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				width: 14px;
				height: 14px;
				background: #7ec8e8;
				border-radius: 50%;
				cursor: pointer;
				transition: transform 0.15s ease;
			}

			.slider-control::-webkit-slider-thumb:hover {
				transform: scale(1.15);
			}

			.slider-control::-moz-range-thumb {
				width: 14px;
				height: 14px;
				background: #7ec8e8;
				border: none;
				border-radius: 50%;
				cursor: pointer;
			}

			/* Hotspot Info Panel Styles */
			.hotspot-panel {
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%) scale(0.9);
				background: rgba(242, 238, 230, 0.9);
				border-radius: 20px;
				padding: 32px 40px;
				color: #000000;
				font-family: 'Noto Sans JP', sans-serif;
				backdrop-filter: blur(16px);
				z-index: 200;
				max-width: 420px;
				width: 70%;
				opacity: 0;
				visibility: hidden;
				transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
				box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
			}

			.hotspot-panel.active {
				opacity: 0.9;
				visibility: visible;
				transform: translate(-50%, -50%) scale(1);
			}

			.hotspot-panel-header {
				display: flex;
				justify-content: end;
				align-items: flex-start;
				margin-bottom: 20px;
			}

			.hotspot-panel h2 {
				margin: 0;
				font-family: 'Cormorant Garamond', serif;
				font-size: 26px;
				font-weight: 500;
				color: #000000;
				letter-spacing: 1px;
			}

		.hotspot-panel-close {
			color: #000000;
			width: 36px;
			height: 36px;
			border-radius: 50%;
			cursor: pointer;
			font-size: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
			flex-shrink: 0;
			margin-left: 16px;
			background: transparent;
			border: none;
		}

		.hotspot-panel-close:hover {
			opacity: 0.7;
			transform: scale(1.1);
		}

			.hotspot-panel p {
				margin: 0 0 16px 0;
				font-size: 14px;
				line-height: 1.7;
				color: #000000;
			}

			.hotspot-panel p:last-child {
				margin-bottom: 0;
			}

			.hotspot-panel .highlight {
				color: #dbb85c;
				font-weight: 500;
			}

			.hotspot-panel video {
				width: 100%;
				border-radius: 0px;
				margin-top: 16px;
				background: #000;
			}

			.hotspot-panel .video-placeholder {
				width: 100%;
				aspect-ratio: 16/9;
				background: linear-gradient(135deg, rgba(126, 200, 232, 0.15), rgba(219, 184, 92, 0.15));
				border-radius: 12px;
				margin-top: 16px;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				border: 1px dashed rgba(126, 200, 232, 0.3);
			}

			.hotspot-panel .video-placeholder svg {
				width: 48px;
				height: 48px;
				fill: rgba(126, 200, 232, 0.6);
				margin-bottom: 12px;
			}

		.hotspot-panel .video-placeholder span {
			font-size: 12px;
			color: rgba(255, 255, 255, 0.5);
		}

		#panelVideo h3 {
			font-family: Futura, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
			font-weight: 500;
			font-size: 15px;
			leading-trim: none;
			line-height: 100%;
			letter-spacing: 0.05em;
			text-align: center;
			text-transform: uppercase;
		}

			.hotspot-overlay {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 150;
				opacity: 0;
				visibility: hidden;
				transition: all 0.35s ease;
			}

			.hotspot-overlay.active {
				opacity: 0.8;
				visibility: visible;
			}

			/* Hotspot Label Tooltips */
			.hotspot-label {
				position: fixed;
				background: rgba(20, 40, 60, 0.9);
				border: 1px solid rgba(126, 200, 232, 0.4);
				border-radius: 8px;
				padding: 8px 14px;
				color: #7ec8e8;
				font-family: 'Noto Sans JP', sans-serif;
				font-size: 12px;
				font-weight: 500;
				pointer-events: none;
				z-index: 120;
				opacity: 0;
				transform: translateY(8px);
				transition: all 0.25s ease;
				white-space: nowrap;
				backdrop-filter: blur(8px);
			}

		.hotspot-label.visible {
			opacity: 1;
			transform: translateY(0);
		}

		/* lil-gui styling */
		.lil-gui {
			--width: 320px;
			--background-color: rgba(20, 40, 60, 0.92);
			--widget-color: rgba(126, 200, 232, 0.3);
			--hover-color: rgba(126, 200, 232, 0.5);
			--focus-color: rgba(126, 200, 232, 0.6);
			--number-color: #7ec8e8;
			--string-color: #7ec8e8;
			--font-size: 12px;
			--input-font-size: 12px;
			--font-family: 'Noto Sans JP', sans-serif;
			--padding: 8px;
			--spacing: 6px;
			--title-height: 32px;
			--title-background-color: rgba(126, 200, 232, 0.15);
			--title-text-color: #7ec8e8;
			--widget-height: 24px;
			--border-color: rgba(126, 200, 232, 0.3);
			--border-radius: 8px;
			z-index: 1000;
			backdrop-filter: blur(12px);
		}

		.lil-gui.root {
			position: fixed;
			top: 20px;
			right: 20px;
			max-height: calc(100vh - 40px);
			overflow-y: auto;
			overflow-x: hidden;
		}

		/* Ensure GUI content doesn't overflow */
		.lil-gui .children {
			max-height: calc(100vh - 100px);
			overflow-y: auto;
		}

	/* Keyboard shortcuts hint - HIDDEN */
	#keyboardHints {
		display: none !important;
	}

	</style>
	</head>
	<body>

		<div id="info">
			<a href="https://threejs.org/" target="_blank" rel="noopener" class="logo-link"></a>

			<div class="title-wrapper">
				<a href="https://threejs.org/" target="_blank" rel="noopener">three.js</a>
				<span>Toki Japanese Highball</span>
			</div>

			<small>
				Tap hotspots to learn more. Drag to orbit.
			</small>
		</div>

		<div id="drinkControls" role="region" aria-label="Drink controls">
			<h3>Highball Settings</h3>
			<div class="control-row">
				<label for="fizzSlider">Carbonation</label>
				<div class="controls">
					<input type="range" id="fizzSlider" class="slider-control" min="0" max="300" step="10" value="300" aria-label="Fizz intensity">
					<span id="fizzValue">300%</span>
				</div>
			</div>
			<div class="control-row">
				<label id="sliceLabel">Orange Peel</label>
				<div class="controls">
					<button id="sliceToggle" aria-pressed="false" aria-describedby="sliceLabel">Hidden</button>
				</div>
			</div>
		</div>

	<!-- Keyboard Shortcuts Hint -->
	<div id="keyboardHints">
		<h4>⌨️ Keyboard Shortcuts</h4>
		<div><kbd>G</kbd> Toggle Glass</div>
		<div><kbd>H</kbd> Toggle Light Helpers</div>
		<div><kbd>T</kbd> Translate Gizmo</div>
		<div><kbd>R</kbd> Rotate Gizmo</div>
		<div><kbd>S</kbd> Scale Gizmo</div>
		<div><kbd>D</kbd> Detach Gizmo</div>
	</div>

	<!-- Hotspot Overlay -->
		<div id="hotspotOverlay" class="hotspot-overlay" role="presentation"></div>

		<!-- Hotspot Info Panels -->
		<div id="panelWhisky" class="hotspot-panel" role="dialog" aria-labelledby="panelWhiskyTitle" aria-modal="true">
			<div class="hotspot-panel-header">
				<button class="hotspot-panel-close" aria-label="Close panel" tabindex="0">×</button>
			</div>
			<p>
				Toki is a whisky blended for crafting highballs. 
				<br><br>
The House of Suntory crafted Toki using a bolder grain whisky from the Chita Distillery, with more flavor than is typical in blended whiskies. 
				<br><br>
				The Chita whisky’s chocolatey aromas and creamy profile complement citrus notes from Hakushu Malt and a long finish from Yamazaki Spanish Oak. A perfect blend of depth and lightness for a satisfying highball.
				<br><br>
			</p>
		</div>

		<div id="panelIce" class="hotspot-panel" role="dialog" aria-labelledby="panelIceTitle" aria-modal="true">
			<div class="hotspot-panel-header">
				<button class="hotspot-panel-close" aria-label="Close panel" tabindex="0">×</button>
			</div>
			<p>
				Toki is a whisky blended for crafting highballs. 
				<br><br>
The House of Suntory crafted Toki using a bolder grain whisky from the Chita Distillery, with more flavor than is typical in blended whiskies. 
				<br><br>
				The Chita whisky’s chocolatey aromas and creamy profile complement citrus notes from Hakushu Malt and a long finish from Yamazaki Spanish Oak. A perfect blend of depth and lightness for a satisfying highball.
				<br><br>
			</p>
		</div>

		<div id="panelGlass" class="hotspot-panel" role="dialog" aria-labelledby="panelGlassTitle" aria-modal="true">
			<div class="hotspot-panel-header">
				<button class="hotspot-panel-close" aria-label="Close panel" tabindex="0">×</button>
			</div>
			<p>
				Toki is a whisky blended for crafting highballs. 
				<br><br>
The House of Suntory crafted Toki using a bolder grain whisky from the Chita Distillery, with more flavor than is typical in blended whiskies. 
				<br><br>
				The Chita whisky’s chocolatey aromas and creamy profile complement citrus notes from Hakushu Malt and a long finish from Yamazaki Spanish Oak. A perfect blend of depth and lightness for a satisfying highball.
				<br><br>
			</p>
		</div>

		<div id="panelVideo" class="hotspot-panel" role="dialog" aria-labelledby="panelVideoTitle" aria-modal="true">
			<div class="hotspot-panel-header">
				<button class="hotspot-panel-close" aria-label="Close panel" tabindex="0">×</button>
			</div>
			<video 
				id="perfectServeVideo"
				src="./images/perfect-serve.mp4"
				controls
				playsinline
				preload="metadata"
			>
				Your browser does not support the video tag.
			</video>
			<h3>TOKI HIGHBALL RECIPE</h3>
		</div>

		<div id="panelEnso" class="hotspot-panel hotspot-panel--enso" role="dialog" aria-labelledby="panelEnsoTitle" aria-modal="true">
			<div class="hotspot-panel-header">
				<button class="hotspot-panel-close" aria-label="Close panel" tabindex="0">×</button>
			</div>
			<h2 id="panelEnsoTitle">Enso</h2>
			<p class="highlight">The Art of the Strokes</p>
			<p>
				Trace the enso circle, a symbol of enlightenment and the beauty of imperfection in Japanese culture.
			</p>
			<div id="ensoCanvasContainer" style="width: 100%; height: 300px; margin: 16px 0; background: #F5F0E8; border-radius: 4px;"></div>
			<div id="ensoProgress" style="margin-top: 12px;">
				<div style="width: 100%; height: 4px; background: rgba(74, 63, 53, 0.2); border-radius: 2px; overflow: hidden; margin-bottom: 8px;">
					<div id="ensoProgressFill" style="height: 100%; background: #8B7355; border-radius: 2px; width: 0%; transition: width 0.3s ease;"></div>
				</div>
				<div id="ensoProgressText" style="font-size: 11px; text-align: center; color: #4A3F35; text-transform: uppercase; letter-spacing: 1px;">Trace the circle</div>
			</div>
		</div>

		<!-- Hotspot Label Tooltip -->
		<div id="hotspotLabel" class="hotspot-label"></div>

		<script type="importmap">
			{
				"imports": {
					"three": "./build/three.module.js",
					"three/addons/": "./lib/jsm/"
				}
			}
		</script>

		<script type="module" src="./src/js/toki/main.js"></script>
		
		<script>
			// Listen for AR start messages from parent window
			window.addEventListener('message', async (event) => {
				if (event.data?.type === 'startAR') {
					// Wait for main.js to load and expose startARSession
					const maxWait = 5000;
					const startTime = Date.now();
					
					const checkAndStart = () => {
						if (window.startARSession) {
							window.startARSession();
						} else if (Date.now() - startTime < maxWait) {
							setTimeout(checkAndStart, 100);
						}
					};
					
					checkAndStart();
				}
			});
		</script>
	</body>
</html>
